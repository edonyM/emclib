language: c
compiler:
  - gcc

# This is a lie: we don't need sudo but this is required to get an
# Ubuntu image with a libc that isn't ancient, and with cmocka libs.
sudo: required
dist: trusty

addons:
  apt:
    packages:

install: true

before_script:

script:
    - ./bootstrap && ./configure
    - make
    - make check
    - cd test
    - for item in `ls -1 *.gcno`; do cp $item ${item##test_colorprint-}; done
    - ./colorprint
    - for item in `ls -1 *.gcda`; do cp $item ${item##test_colorprint-}; done
    - cd .. && gcov test/test_colorprint.c

after_success:
    - bash <(curl -s https://codecov.io/bash)
